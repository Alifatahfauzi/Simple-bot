import fetch from 'node-fetch';

let handler = async (m, plug) => {
    const { reply, q, prefix, reaction } = plug;
    
    let mediafireUrl = q.trim();

    if (!mediafireUrl || !mediafireUrl.includes("mediafire.com")) {
        return reply(`⚠️ *Format Salah!*\n\nMasukkan link MediaFire.\nContoh: ${prefix}mediafire [link]`);
    }

    await reaction(m.chat, "⏳");
    
    const BASE_URL = "https://velyn.mom/api/downloader/mediafire";
    
    try {
        const urlParams = new URLSearchParams({
            apikey: global.velynApiKey,
            url: mediafireUrl
        });
        
        const apiUrl = `${BASE_URL}?${urlParams.toString()}`;

        const apiResponse = await fetch(apiUrl);
        const result = await apiResponse.json();

        if (result.status === 200 && result.data?.url) {
            
            const fileUrl = result.data.url;
            const fileName = result.data.title || 'mediafire_file';
            const fileSize = result.data.size || 'N/A';
            
            // Mengirim file yang diunduh sebagai dokumen
            await plug.conn.sendMessage(m.chat, { 
                document: { url: fileUrl },
                fileName: fileName,
                mimetype: 'application/octet-stream', // Mimetype generik
                caption: `✅ *MediaFire Download Berhasil!*
*Nama File:* ${fileName}
*Ukuran:* ${fileSize}
*Link Asli:* ${mediafireUrl}`
            }, { quoted: m });
            
        } else {
            reply(`❌ Gagal mengunduh file MediaFire. Pesan API: ${result.message || 'Link tidak valid atau API key bermasalah.'}`);
        }

    } catch (error) {
        reply(`❌ Terjadi kesalahan koneksi saat memproses permintaan: ${error.message}`);
    }
};

handler.command = ['mediafire', 'mf']; 
handler.help = ['mediafire'];
handler.tags = ['downloader'];
handler.owner = false;

export default handler;